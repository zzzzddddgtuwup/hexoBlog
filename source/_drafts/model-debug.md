---
title: model_debug
tags:
---

## 收敛问题
### 模型不收敛怎么办？
1. 模型是不是有type的bug？用tfdbg调试
2. 调试learning rate
3. 改变optimizer
4. 数据可能有问题？有没有坏的数据？
5. 改变模型的复杂度
***
### 模型在训练的时候比测试的结果好
可能是过拟合了。我们可以
1. 降低模型的复杂度
2. 加入regularization或者drop out
3. 确保训练数据和测试数据的分布是一致的
***
### 单机训练可以收敛，但是分布式训练不可以
1. learning rate太高了。分布式训练的时候是多台机器同时更新参数，梯度的噪声会更大
2. 分布式的训练最好逐渐启动。因为在最初的训练过程中，梯度很敏感。如果同时太多机器更新，会使得梯度更新noisy。我们可以先一台机器，逐渐增加机器。
3. 使用同步的方式更新参数
***
### 梯度爆炸
1. 确保数据没有问题。为pipeline写一些测试。看看有没有outliers
2. 确保batch选取的数据是随机均匀的。
3. 梯度也要保证在一定范围内，可以设一个上限

## 性能问题
1. 使用global_step/sec来做metrics。它衡量了每秒钟有多少train op
2. 观察queue的状态。一般queue是用来读取数据的，我们希望他一直是满的。如果是空的，可以加线程。
3. 小心大的变量，需要把它partition使用create_partition_variables()。也记得要shuffle
